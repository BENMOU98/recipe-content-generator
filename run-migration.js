console.log('Creating migration runner...'); const sqlite3 = require('sqlite3').verbose(); const fs = require('fs'); const path = require('path'); const dbPath = path.join(__dirname, 'data', 'recipes.db'); const migrationPath = path.join(__dirname, 'migrations', 'add_website_templates_and_buffer_scheduler.sql'); console.log('Running migration:', 'add_website_templates_and_buffer_scheduler.sql'); const migrationSQL = fs.readFileSync(migrationPath, 'utf8'); const db = new sqlite3.Database(dbPath); const statements = migrationSQL.split(';').map(stmt => stmt.trim()).filter(stmt => stmt.length > 0); console.log('Found', statements.length, 'SQL statements to execute'); let completed = 0; db.serialize(() => { statements.forEach((statement, index) => { if (statement.trim()) { db.run(statement, function(err) { if (err) { console.error('Error executing statement', index + 1, ':', err.message); console.error('Statement:', statement.substring(0, 100) + '...'); } else { console.log('✅ Statement', index + 1, 'executed successfully'); } completed++; if (completed === statements.length) { console.log('✅ Migration completed successfully'); db.close(); } }); } }); });
